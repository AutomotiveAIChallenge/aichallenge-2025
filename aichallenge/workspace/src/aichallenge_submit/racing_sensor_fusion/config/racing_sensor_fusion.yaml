# ==========================================================
    # ピットレーン走行時設定（10km/h以下）
    # ==========================================================
    # ピットレーン時は安全最優先の慎重な制御
    
    # ピット時GNSS重み - 安全重視
    pit_gnss_weight: 0.70
    
    # ピット時IMU重み - 慎重な姿勢制御
    pit_imu_weight: 0.30

# ==========================================================
# カートレース用センサーフュージョン設定ファイル
# ==========================================================
# お台場カート場での36秒→33秒台を目指すための最適化設定

racing_sensor_fusion:
  ros__parameters:
    # ==========================================================
    # 基本処理設定
    # ==========================================================
    # 更新頻度 [Hz] - 33秒台達成のための高速処理
    # 値を大きくすると：応答が速くなる、CPU使用量増加
    # 値を小さくすると：省電力、応答が遅くなる
    # 推奨値：50Hz（カートレース用高速処理）
    update_frequency: 50.0
    
    # 予測時間 [秒] - 車両挙動問題解決のための最適化
    # 【オーバステア抑制】コーナー出口での過度な操舵を防ぐ
    # 【ハンドル振れ抑制】直線での左右振動を抑制
    # 値を大きくすると：より先を予測、安定性UP、応答性DOWN
    # 値を小さくすると：即座に応答、機敏性UP、振動リスク
    # 推奨値：0.08秒（35km/h時に約0.8m先を予測、安定性重視）
    prediction_time: 0.08
    
    # 履歴保存数 - 平均化に使用するデータ数
    # 値を大きくすると：ノイズに強い、応答遅い
    # 値を小さくすると：応答早い、ノイズに弱い
    # 推奨値：10個（0.2秒分の履歴）
    history_size: 10
    
    # ==========================================================
    # センサー重み設定（基本）
    # ==========================================================
    # 通常走行時のセンサー重み（合計1.0になるよう調整）
    # GNSSを重視：位置精度向上、IMUを重視：応答性向上
    
    # GNSS標準重み - 位置精度重視
    # 大きくすると：位置精度UP、動的応答DOWN
    # 小さくすると：動的応答UP、位置精度DOWN
    gnss_weight_default: 0.7
    
    # IMU標準重み - 動的応答重視
    # 大きくすると：動的応答UP、位置精度DOWN
    # 小さくすると：位置精度UP、動的応答DOWN
    imu_weight_default: 0.3
    
    # ==========================================================
    # 速度帯別判定しきい値（実走行データ基準）
    # ==========================================================
    # 【実際の走行状況】
    # - 直線走行: 35km/h（最高速度）
    # - コーナー走行: 29-34km/h
    # - ピットレーン: 10km/h以下
    
    # 直線走行判定しきい値 [km/h] - この速度以上で直線モード
    # 直線モード：GNSS重視で安定した直線走行
    # ハンドル振れ抑制のため位置精度を最重視
    high_speed_threshold: 34.5
    
    # コーナー走行判定しきい値 [km/h] - この速度以下でコーナーモード
    # コーナーモード：IMU重視で機敏な姿勢制御
    # オーバステア抑制のため動的応答を重視
    corner_speed_threshold: 28.0
    
    # ==========================================================
    # 直線走行時設定（35km/h付近）
    # ==========================================================
    # 【目的】ハンドル振れ抑制、安定した直線走行
    # 直線走行時はGNSSの位置精度を最重視
    # ハンドル左右振れを抑制するため位置安定性を優先
    
    # 直線時GNSS重み - ハンドル振れ抑制のため位置精度最重視
    # 大きくすると：直線安定性UP、ハンドル振れ抑制
    # 小さくすると：応答性UP、但しハンドル振れリスク
    straight_gnss_weight: 0.85
    
    # 直線時IMU重み
    straight_imu_weight: 0.15
    
    # ==========================================================
    # コーナー走行時設定（29-34km/h）
    # ==========================================================
    # 【目的】オーバステア抑制、適切なコーナリング制御
    # コーナー走行時はIMUとGNSSのバランス重視
    # オーバステア抑制のため予測制御を活用
    
    # コーナー時GNSS重み
    corner_gnss_weight: 0.60
    
    # コーナー時IMU重み - オーバステア抑制のため適度な応答
    # 大きくすると：機敏な制御、オーバステアリスク
    # 小さくすると：安定制御、アンダーステア傾向
    corner_imu_weight: 0.40

# ==========================================================
# 参考：実走行データに基づく速度帯と走行状況の対応
# ==========================================================
# 直線走行（34.5+ km/h）：ストレート走行
# - GNSS重み85%：ハンドル振れ抑制、安定した軌道維持
# - IMU重み15%：基本的な姿勢保持
# - 【解決する問題】直線でのハンドル左右振れ
#
# コーナー走行（28-34.5 km/h）：コーナー中
# - GNSS重み60%：位置精度維持
# - IMU重み40%：適度な応答性でオーバステア抑制
# - 【解決する問題】コーナー出口のオーバステア
#
# ピットレーン（28- km/h）：ピット走行
# - GNSS重み70%：安全重視の安定制御
# - IMU重み30%：慎重な姿勢制御
#
# ==========================================================
# 車両挙動問題の解決方針
# ==========================================================
# 【問題1】コーナー出口でのオーバステア
# 解決策：
# - コーナー時のIMU重みを40%に調整（過度な応答を抑制）
# - 予測時間を0.08秒に延長（先読み制御で安定化）
# - GNSS重み60%で位置安定性を確保
#
# 【問題2】直線でのハンドル左右振れ
# 解決策：
# - 直線時のGNSS重みを85%に設定（位置精度最重視）
# - IMU重みを15%に抑制（過度な姿勢補正を防ぐ）
# - 履歴データ平滑化で振動抑制
#
# ==========================================================
# 33秒台達成のためのチューニング指針
# ==========================================================
# 1. 基本性能向上：
#    - update_frequencyを50→55Hzに調整
#    - prediction_timeを0.08→0.09秒に微調整
#
# 2. コーナー攻略最適化：
#    - corner_imu_weightを0.40→0.45に調整（より機敏に）
#    - corner_speed_thresholdを28.0→29.0に調整
#
# 3. 直線安定性向上：
#    - straight_gnss_weightを0.85→0.90に調整（更に安定）
#
# 4. 全体最適化：
#    - history_sizeを10→12に調整（より安定）
#
# 【重要】段階的に調整し、各パラメータの効果を確認すること
